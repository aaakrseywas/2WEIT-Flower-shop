<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>2WEIT flower - Корзина</title>
    <link rel="stylesheet" href="/static/order.css">
    <link rel="stylesheet" href="/static/header.css">
    <link rel="stylesheet" href="/static/footer.css">

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Carlito:ital,wght@0,400;0,700;1,400;1,700&family=Overpass+Mono:wght@300..700&display=swap" rel="stylesheet">

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Rubik:ital,wght@0,300..900;1,300..900&display=swap" rel="stylesheet">

<script>
document.addEventListener('DOMContentLoaded', function() {
    const buttons = document.querySelectorAll('.add-to-cart');

    buttons.forEach(button => {
        // Инициализируем счетчик для каждой кнопки
        let count = 0;

        button.addEventListener('click', function() {
            count++;

            // Получаем данные о товаре из формы
            const form = this.closest('form');
            const productName = form.querySelector('input[name="flower_name"]').value;
            const productType = form.querySelector('input[name="flower_sort"]').value;
            const productColor = form.querySelector('input[name="flower_color"]').value;
            const productPrice = parseFloat(form.querySelector('input[name="flower_price"]').value);

            // Отправляем данные на сервер
            fetch('/add_to_cart', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'X-Requested-With': 'XMLHttpRequest'
                },
                body: JSON.stringify({
                    name: productName,
                    sort: productSort,
                    color: productColor,
                    price: productPrice,
                    quantity: count
                })
            })
            .then(response => response.json())
            .then(data => {
                if(data.success) {
                    if(count === 1) {
                        this.innerHTML = 'В корзине <span class="count">1</span> ✓';
                        this.classList.add('in-cart');
                        this.style.backgroundColor = '#a0a0a0';
                    } else {
                        this.innerHTML = `В корзине <span class="count">${count}</span> ✓`;
                    }

                    // Анимация
                    this.style.transform = 'scale(1.05)';
                    setTimeout(() => {
                        this.style.transform = 'scale(1)';
                    }, 200);
                }
            });
        });
    });
});
</script>
<body>
    {% include "header.html" %}
     <main>
    <div class="cart-container">
        <h1 class="cart-title">КОРЗИНА</h1>
        <div class="cart-content">
            <h3 class="cart-subtitle">Ваши заказы:</h3>
            {% if cart %}
                <ul class="cart-items">
                    {% for item in cart %}
                        <li class="cart-item">
                            <span class="item-name">{{ item.name }}</span>
                            <span class="item-details">({{ item.sort }}, {{ item.color }})</span>
                            <span class="item-price">{{ item.price }} руб.</span>
                        </li>
                    {% endfor %}
                </ul>
                <div class="cart-total">
                    <p>Итоговая сумма: <span>{{ total_price }} руб.</span></p>
                </div>
            {% else %}
                <div class="empty-cart">
                    <p>Ваша корзина пуста</p>
                    <a href="/2weit/menu" class="continue-shopping-btn">Выбрать цветы</a>
                </div>
            {% endif %}

            {% if cart %}
                <div class="cart-actions">
                    <a href="/2weit/menu" class="add-more-btn">Добавить еще цветы</a>
                    <form class="checkout-form" action="/2weit/order" method="post">
                        <h4>Оформление заказа</h4>
                        <div class="form-group">
                            <input type="text" name="name" placeholder="Ваше имя" required>
                        </div>
                        <div class="form-group">
                            <input type="text" name="comment" placeholder="Комментарий(необязательно)" required>
                        </div>
                        <div class="form-group">
                            <input type="text" name="address" placeholder="Адрес доставки" required>
                        </div>
                        <div class="form-group">
                            <input type="email" name="email" placeholder="Email" required>
                        </div>
                        <div class="form-group">
                            <select name="payment_method" required>
                                <option value="" disabled selected>Выберите способ оплаты</option>
                                <option value="card">Банковская карта</option>
                                <option value="cash">Наличные при получении</option>
                            </select>
                        </div>
                        <div class="form-buttons">
                            <button type="submit" class="checkout-btn">Подтвердить заказ</button>
                            <button type="submit" formaction="/2weit/order/clear_cart" class="clear-cart-btn">Очистить корзину</button>
                        </div>
                    </form>
                </div>
            {% endif %}
        </div>
    </div>
</main>
    {% include "footer.html" %}
</body>
</html>